<p-message *ngIf="errorMessage" severity="error">{{ errorMessage }}</p-message>
<p-confirmdialog />

<div #swipeZone class="workout-session">
    <ng-container *ngIf="isLoading else content">
        <div class="mt-2">
            <div class="flex-1 flex justify-content-around align-items-center">
                <p-skeleton shape="circle" size="3rem" styleClass="mr-2" />
                <p-skeleton shape="circle" size="3rem" styleClass="mr-2" />
                <p-skeleton shape="circle" size="3rem" styleClass="mr-2" />
                <p-skeleton shape="circle" size="3rem" styleClass="mr-2" />
            </div>


            <div class="flex-1 flex flex-column justify-center align-items-center mt-6 mb-8">
                <p-skeleton class="mb-4" width="10rem" height="3rem" />
                <p-skeleton width="15rem" height="4rem" />
            </div>

            <div class="bottom-page">
                <div class="stopwatch text-primary mb-3">
                <span>
                    <p-skeleton width="8rem" height="3rem" />
                </span>
                </div>
                <p-skeleton shape="circle" size="4rem" styleClass="mr-2" />
            </div>
        </div>
    </ng-container>


    <ng-template #content>
        <p-confirmdialog></p-confirmdialog>


        <p-stepper [(value)]="activeStep" class="basis-[40rem]">
            <p-step-list class="flex justify-center w-full">
                <ng-container *ngFor="let exercise of exercises; let index = index">
                    <p-step [value]="index + 1">
                        <ng-template #content let-activateCallback="activateCallback" let-value="value">
                            <button class="step-button"
                                    [ngClass]="{
                        'bg-primary text-primary-contrast border-primary': value === activeStep,
                        'border-surface': value > activeStep
                    }"
                                    (click)="switchPanel(exercise, activateCallback)">
                                <span class="step-button-span">{{ index + 1 }}</span>
                            </button>
                        </ng-template>
                    </p-step>
                </ng-container>
            </p-step-list>


            <p-step-panels>
                <ng-container *ngFor="let exercise of exercises; let index = index">
                    <p-step-panel [value]="index + 1">
                        <ng-template #content let-activateCallback="activateCallback">
                            <div class="flex-1 flex-col gap-2 mx-auto mb-6" style="max-width: 20rem">
                                <div class="text-center mt-4 mb-4 text-xl font-semibold">
                                    <h3 class="text-2xl">{{ exercise.name | uppercase }}</h3>
                                </div>
                                <div class="flex items-center mt-2">
                                    <button (click)="decreaseWeight()" pButton pRipple type="button" icon="pi pi-minus"
                                            class="button-increase-decrease-weight"
                                            [disabled]="timer.interval"
                                            [ngClass]="{
                                            'border-dark': isDarkMode,
                                            'border-light': !isDarkMode,
                                            }"
                                    ></button>

                                    <p-inputNumber
                                        [(ngModel)]="weight"
                                        [disabled]="timer.interval"
                                        [suffix]="' kg'">
                                    </p-inputNumber>

                                    <button (click)="increaseWeight()" pButton pRipple type="button" icon="pi pi-plus"
                                            class="button-increase-decrease-weight"
                                            [disabled]="timer.interval"
                                            [ngClass]="{
                                            'border-dark': isDarkMode,
                                            'border-light': !isDarkMode,
                                            }"></button>
                                </div>
                            </div>
                        </ng-template>
                    </p-step-panel>
                </ng-container>
            </p-step-panels>
        </p-stepper>

        <div *ngIf="exercisesMade.length > 0" class="card">
           <app-exercises-table [exercisesMade]="exercisesMade"></app-exercises-table>
        </div>

        <div class="bottom-page">
            <div class="stopwatch text-primary">
                <span>{{ timer.text }}</span>
            </div>

            <div (click)="toggleTimer()" class="button-toggle-timer" [ngClass]="{
                'disabled': this.weight < 0 || this.weight >= 500
            }">
                <ng-container *ngIf="timer.interval !== null else play">
                    <fa-icon [icon]="faIcons.faPause"></fa-icon>
                </ng-container>
                <ng-template #play>
                    <fa-icon [icon]="faIcons.faPlay"></fa-icon>
                </ng-template>
            </div>
        </div>
    </ng-template>
</div>
